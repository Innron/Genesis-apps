<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üì´ Genesis Postal Clock</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a1a;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }
        
        .screen { display: none; min-height: 100vh; width: 100%; overflow-y: auto; }
        .screen.active { display: flex; flex-direction: column; }
        
        /* CODE SCREEN */
        .code-screen {
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .logo { font-size: 80px; margin-bottom: 20px; }
        .title { font-size: 28px; font-weight: 700; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #aaa; margin-bottom: 30px; text-align: center; }
        
        .code-input {
            width: 100%;
            max-width: 300px;
            padding: 18px;
            font-size: 20px;
            text-align: center;
            border: 3px solid #333;
            border-radius: 15px;
            background: #111;
            color: #00ff88;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .code-input:focus { outline: none; border-color: #0984e3; }
        
        .btn {
            width: 100%;
            max-width: 300px;
            padding: 18px;
            margin-top: 15px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .btn-primary { background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%); color: #fff; }
        .btn-success { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: #000; }
        .btn-danger { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: #fff; }
        .btn-warning { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: #000; }
        .btn-purple { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: #fff; }
        .btn-orange { background: linear-gradient(135deg, #e17055 0%, #d63031 100%); color: #fff; }
        
        .error-msg { color: #ff6b6b; margin-top: 15px; text-align: center; display: none; }
        .error-msg.show { display: block; }
        
        /* SETUP SCREEN */
        .setup-screen {
            padding: 30px 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .setup-header { text-align: center; margin-bottom: 30px; }
        
        .form-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #ccc; }
        .form-hint { font-size: 12px; color: #888; margin-top: 5px; }
        
        .form-input, .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 16px;
        }
        
        .form-input:focus, .form-select:focus { outline: none; border-color: #0984e3; }
        
        /* MAIN APP */
        .main-screen { background: #0a0a1a; }
        
        .app-header {
            background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%);
            padding: 15px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .app-title { font-size: 18px; font-weight: 700; }
        
        .employee-badge {
            display: inline-block;
            background: rgba(0,0,0,0.2);
            padding: 6px 12px;
            border-radius: 20px;
            margin-top: 8px;
            font-size: 12px;
        }
        
        .date-display {
            background: #111;
            padding: 12px;
            text-align: center;
            font-size: 14px;
            color: #aaa;
        }
        
        .main-content { padding: 15px; padding-bottom: 100px; }
        
        /* STATUS CARD */
        .status-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .status-card.on-lunch {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }
        
        .status-card.on-break {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
        }
        
        .status-label { font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 5px; }
        .status-value { font-size: 48px; font-weight: 800; font-family: 'Courier New', monospace; }
        .status-activity { font-size: 16px; color: #74b9ff; margin-top: 10px; }
        
        /* ACTIVITY SELECTOR */
        .activity-section { margin-bottom: 20px; }
        .section-label { font-size: 12px; color: #888; margin-bottom: 10px; text-transform: uppercase; }
        
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .activity-grid.clerk-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .activity-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 12px 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
        }
        
        .activity-btn.selected {
            background: rgba(9, 132, 227, 0.3);
            border-color: #0984e3;
        }
        
        .activity-icon { font-size: 20px; display: block; margin-bottom: 3px; }
        .activity-name { font-size: 9px; color: #ccc; }
        
        /* ROUTE INPUT */
        .route-input-group {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .route-input-label { font-size: 12px; color: #aaa; margin-bottom: 8px; }
        
        .route-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 18px;
            text-align: center;
        }
        
        /* ACTION BUTTONS */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 15px 8px;
            border: none;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .btn-clock-in { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: #000; }
        .btn-clock-out { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: #fff; }
        .btn-switch { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: #000; }
        .btn-lunch { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: #fff; }
        .btn-break { background: linear-gradient(135deg, #e17055 0%, #d63031 100%); color: #fff; }
        .btn-end-lunch { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: #000; }
        
        /* LUNCH/BREAK INFO */
        .lunch-info {
            background: rgba(155, 89, 182, 0.2);
            border: 2px solid #9b59b6;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .break-info {
            background: rgba(225, 112, 85, 0.2);
            border: 2px solid #e17055;
            border-radius: 12px;
            padding: 10px 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* TODAY'S ENTRIES */
        .entries-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .entries-header { font-weight: 600; margin-bottom: 15px; font-size: 14px; }
        
        .entry-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .entry-item.lunch-entry { border-left: 3px solid #9b59b6; }
        .entry-item.break-entry { border-left: 3px solid #e17055; }
        
        .entry-info { flex: 1; }
        .entry-name { font-weight: 600; font-size: 13px; }
        .entry-times { font-size: 11px; color: #aaa; }
        .entry-duration { font-family: monospace; font-weight: 600; color: #00ff88; font-size: 14px; }
        
        /* TOTALS */
        .totals-card {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .totals-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .total-item { text-align: center; }
        .total-label { font-size: 10px; color: #aaa; }
        .total-value { font-size: 20px; font-weight: 700; color: #00ff88; }
        
        /* GREEN CARD BUTTON */
        .green-card-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        /* MODAL */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal.show { display: flex; }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title { font-size: 18px; font-weight: 700; }
        .modal-close { background: none; border: none; font-size: 24px; color: #fff; cursor: pointer; }
        
        .green-card-output {
            background: #111;
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 11px;
            white-space: pre-wrap;
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        /* LUNCH ALERT */
        .lunch-alert {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(155, 89, 182, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            flex-direction: column;
            padding: 40px;
        }
        
        .lunch-alert.show { display: flex; }
        
        .lunch-alert-icon { font-size: 80px; margin-bottom: 20px; }
        .lunch-alert-title { font-size: 28px; font-weight: 700; margin-bottom: 10px; }
        .lunch-alert-countdown { font-size: 60px; font-weight: 800; font-family: monospace; }
        .lunch-alert-text { font-size: 16px; margin-top: 15px; opacity: 0.9; }
        
        /* NAV BAR */
        .nav-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #111;
            display: flex;
            padding: 10px 0;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }
        
        .nav-item.active { color: #0984e3; }
        .nav-icon { font-size: 20px; display: block; }
        .nav-label { font-size: 10px; margin-top: 3px; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* HISTORY TAB */
        .history-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .history-date { font-weight: 600; margin-bottom: 8px; }
        .history-details { font-size: 13px; color: #aaa; }
        .history-total { font-size: 16px; font-weight: 600; color: #00ff88; margin-top: 8px; }
        
        /* SETTINGS TAB */
        .settings-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .settings-title { font-weight: 600; margin-bottom: 15px; }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .setting-item:last-child { border-bottom: none; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- LUNCH ALERT POPUP -->
    <div class="lunch-alert" id="lunchAlert">
        <div class="lunch-alert-icon">üçî</div>
        <div class="lunch-alert-title">Lunch Ending!</div>
        <div class="lunch-alert-countdown" id="lunchCountdown">30</div>
        <div class="lunch-alert-text">seconds to clock back in</div>
        <button class="btn btn-success" onclick="endLunch()" style="margin-top:30px;">‚úÖ Clock Back In</button>
    </div>

    <!-- SCREEN 1: CODE ENTRY -->
    <div id="codeScreen" class="screen active code-screen">
        <div class="logo">üì´</div>
        <div class="title">Genesis Postal Clock</div>
        <div class="subtitle">Time tracking for USPS Carriers & Clerks</div>
        
        <input type="text" class="code-input" id="inviteCode" placeholder="Enter code (e.g. 6KSVY)">
        <button class="btn btn-primary" onclick="validateCode()">üîì Enter App</button>
        <div class="error-msg" id="codeError">‚ùå Invalid code</div>
    </div>
    
    <!-- SCREEN 2: EMPLOYEE SETUP -->
    <div id="setupScreen" class="screen setup-screen">
        <div class="setup-header">
            <div style="font-size:60px; margin-bottom:15px;">üì´</div>
            <h2>Employee Setup</h2>
            <p style="color:#aaa; margin-top:10px;">Set up your profile to get started</p>
        </div>
        
        <div class="form-card">
            <label class="form-label">Your Name</label>
            <input type="text" class="form-input" id="employeeName" placeholder="e.g., John Smith">
        </div>
        
        <div class="form-card">
            <label class="form-label">Employee Type</label>
            <select class="form-select" id="employeeType" onchange="updateSetupOptions()">
                <option value="">Select type...</option>
                <option value="carrier">Carrier</option>
                <option value="clerk">Clerk</option>
            </select>
        </div>
        
        <div class="form-card hidden" id="carrierTypeGroup">
            <label class="form-label">Carrier Type</label>
            <select class="form-select" id="carrierType">
                <option value="cca">CCA (City Carrier Assistant)</option>
                <option value="regular">Regular Carrier</option>
                <option value="ptf">PTF (Part-Time Flexible)</option>
                <option value="rca">RCA (Rural Carrier Associate)</option>
                <option value="arc">ARC (Assistant Rural Carrier)</option>
            </select>
            <div class="form-hint">üí° Carrier lunch default is 5 minutes (you can adjust daily)</div>
        </div>
        
        <div class="form-card hidden" id="clerkTypeGroup">
            <label class="form-label">Clerk Type</label>
            <select class="form-select" id="clerkType">
                <option value="pse">PSE (Postal Support Employee)</option>
                <option value="regular">Regular Clerk</option>
                <option value="ptf">PTF (Part-Time Flexible)</option>
            </select>
        </div>
        
        <div class="form-card hidden" id="lunchDurationGroup">
            <label class="form-label">Lunch Duration</label>
            <select class="form-select" id="lunchDuration">
                <option value="5">5 minutes (Carrier default)</option>
                <option value="30">30 minutes</option>
                <option value="60">1 hour</option>
            </select>
            <div class="form-hint" id="lunchHint">Lunch is unpaid - you'll clock out and back in</div>
        </div>
        
        <div class="form-card">
            <label class="form-label">Office Name (Optional)</label>
            <input type="text" class="form-input" id="officeLocation" placeholder="e.g., Dallas Main Office">
        </div>
        
        <div style="max-width:500px; margin:0 auto;">
            <button class="btn btn-success" onclick="completeSetup()" style="max-width:100%;">‚úÖ Complete Setup</button>
        </div>
    </div>
    
    <!-- SCREEN 3: MAIN APP -->
    <div id="mainScreen" class="screen main-screen">
        <div class="app-header">
            <div class="app-title">üì´ Genesis Postal Clock</div>
            <div class="employee-badge" id="employeeBadge">Employee</div>
        </div>
        
        <div class="date-display" id="dateDisplay">Monday, January 27, 2026</div>
        
        <div class="main-content">
            <!-- CLOCK TAB -->
            <div id="clockTab" class="tab-content active">
                <div class="status-card" id="statusCard">
                    <div class="status-label" id="statusLabel">Ready to Clock In</div>
                    <div class="status-value" id="timerDisplay">00:00:00</div>
                    <div class="status-activity" id="currentActivityDisplay"></div>
                </div>
                
                <!-- LUNCH INFO (shown during lunch) -->
                <div class="lunch-info hidden" id="lunchInfoBox">
                    <div style="font-size:24px; margin-bottom:5px;">üçî</div>
                    <div style="font-weight:600;">On Lunch Break</div>
                    <div style="font-size:12px; color:#ccc; margin-top:5px;">Time remaining: <span id="lunchRemaining">--:--</span></div>
                </div>
                
                <!-- BREAK INFO -->
                <div class="break-info" id="breakInfoBox">
                    <div>
                        <div style="font-size:12px; color:#aaa;">‚òï Breaks (15 min each)</div>
                        <div style="font-weight:600;" id="breaksUsed">0 of 2 used</div>
                    </div>
                    <button class="action-btn btn-break" onclick="startBreak()" id="breakBtn" style="flex:0; padding:10px 15px;">Take Break</button>
                </div>
                
                <!-- ROUTE/TASK INPUT -->
                <div class="route-input-group" id="routeInputGroup">
                    <div class="route-input-label" id="routeInputLabel">Route Number</div>
                    <input type="text" class="route-input" id="routeNumber" placeholder="e.g., Route 5">
                </div>
                
                <!-- CARRIER ACTIVITIES -->
                <div class="activity-section" id="carrierActivities">
                    <div class="section-label">Activity</div>
                    <div class="activity-grid">
                        <button class="activity-btn selected" data-activity="casing" onclick="selectActivity(this)">
                            <span class="activity-icon">üì¨</span>
                            <span class="activity-name">Casing</span>
                        </button>
                        <button class="activity-btn" data-activity="delivering" onclick="selectActivity(this)">
                            <span class="activity-icon">üö∂</span>
                            <span class="activity-name">Delivering</span>
                        </button>
                        <button class="activity-btn" data-activity="loading" onclick="selectActivity(this)">
                            <span class="activity-icon">üì¶</span>
                            <span class="activity-name">Loading</span>
                        </button>
                        <button class="activity-btn" data-activity="office" onclick="selectActivity(this)">
                            <span class="activity-icon">üè¢</span>
                            <span class="activity-name">Office</span>
                        </button>
                        <button class="activity-btn" data-activity="travel" onclick="selectActivity(this)">
                            <span class="activity-icon">üöó</span>
                            <span class="activity-name">Travel</span>
                        </button>
                        <button class="activity-btn" data-activity="other" onclick="selectActivity(this)">
                            <span class="activity-icon">üìã</span>
                            <span class="activity-name">Other</span>
                        </button>
                    </div>
                </div>
                
                <!-- CLERK ACTIVITIES -->
                <div class="activity-section hidden" id="clerkActivities">
                    <div class="section-label">Activity</div>
                    <div class="activity-grid clerk-grid">
                        <button class="activity-btn selected" data-activity="box_parcels" onclick="selectActivity(this)">
                            <span class="activity-icon">üì¶</span>
                            <span class="activity-name">Box Parcels</span>
                        </button>
                        <button class="activity-btn" data-activity="box_mail" onclick="selectActivity(this)">
                            <span class="activity-icon">üì¨</span>
                            <span class="activity-name">Box Mail</span>
                        </button>
                        <button class="activity-btn" data-activity="throwing" onclick="selectActivity(this)">
                            <span class="activity-icon">üéØ</span>
                            <span class="activity-name">Throwing</span>
                        </button>
                        <button class="activity-btn" data-activity="casing" onclick="selectActivity(this)">
                            <span class="activity-icon">üìÆ</span>
                            <span class="activity-name">Casing</span>
                        </button>
                        <button class="activity-btn" data-activity="window" onclick="selectActivity(this)">
                            <span class="activity-icon">ü™ü</span>
                            <span class="activity-name">Window</span>
                        </button>
                        <button class="activity-btn" data-activity="dispatch" onclick="selectActivity(this)">
                            <span class="activity-icon">üöö</span>
                            <span class="activity-name">Dispatch</span>
                        </button>
                        <button class="activity-btn" data-activity="rfs" onclick="selectActivity(this)">
                            <span class="activity-icon">üìä</span>
                            <span class="activity-name">RFS</span>
                        </button>
                        <button class="activity-btn" data-activity="pars" onclick="selectActivity(this)">
                            <span class="activity-icon">üì±</span>
                            <span class="activity-name">PARS</span>
                        </button>
                        <button class="activity-btn" data-activity="ubbm" onclick="selectActivity(this)">
                            <span class="activity-icon">üóëÔ∏è</span>
                            <span class="activity-name">UBBM</span>
                        </button>
                        <button class="activity-btn" data-activity="mte" onclick="selectActivity(this)">
                            <span class="activity-icon">üìÅ</span>
                            <span class="activity-name">MTE</span>
                        </button>
                        <button class="activity-btn" data-activity="misc" onclick="selectActivity(this)">
                            <span class="activity-icon">üìã</span>
                            <span class="activity-name">Misc</span>
                        </button>
                    </div>
                </div>
                
                <!-- MAIN ACTION BUTTONS -->
                <div class="action-buttons" id="mainActions">
                    <button class="action-btn btn-clock-in" onclick="clockIn()">‚ñ∂Ô∏è Clock In</button>
                </div>
                
                <div class="action-buttons hidden" id="activeActions">
                    <button class="action-btn btn-switch" onclick="switchActivity()">üîÑ Switch</button>
                    <button class="action-btn btn-lunch" onclick="startLunch()">üçî Lunch</button>
                    <button class="action-btn btn-clock-out" onclick="clockOut()">‚èπÔ∏è Out</button>
                </div>
                
                <div class="action-buttons hidden" id="lunchActions">
                    <button class="action-btn btn-end-lunch" onclick="endLunch()" style="flex:2;">‚úÖ End Lunch - Clock Back In</button>
                </div>
                
                <!-- TODAY'S ENTRIES -->
                <div class="entries-section">
                    <div class="entries-header">üìã Today's Entries</div>
                    <div id="entriesList"><div style="text-align:center; color:#666; padding:20px;">No entries yet today</div></div>
                </div>
                
                <!-- TOTALS -->
                <div class="totals-card">
                    <div class="totals-grid">
                        <div class="total-item">
                            <div class="total-label">Work Time</div>
                            <div class="total-value" id="totalWork">0:00</div>
                        </div>
                        <div class="total-item">
                            <div class="total-label">Lunch</div>
                            <div class="total-value" id="totalLunch" style="color:#9b59b6;">0:00</div>
                        </div>
                        <div class="total-item">
                            <div class="total-label">Breaks</div>
                            <div class="total-value" id="totalBreaks" style="color:#e17055;">0:00</div>
                        </div>
                    </div>
                </div>
                
                <button class="green-card-btn" onclick="showGreenCard()">üìÑ View Green Card Data</button>
            </div>
            
            <!-- HISTORY TAB -->
            <div id="historyTab" class="tab-content">
                <h3 style="margin-bottom:20px;">üìä History</h3>
                <div id="historyList"></div>
            </div>
            
            <!-- SETTINGS TAB -->
            <div id="settingsTab" class="tab-content">
                <h3 style="margin-bottom:20px;">‚öôÔ∏è Settings</h3>
                
                <div class="settings-section">
                    <div class="settings-title">üë§ Profile</div>
                    <div class="setting-item">
                        <span>Name</span>
                        <span id="settingsName">-</span>
                    </div>
                    <div class="setting-item">
                        <span>Type</span>
                        <span id="settingsType">-</span>
                    </div>
                    <div class="setting-item">
                        <span>Office</span>
                        <span id="settingsOffice">-</span>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-title">üçî Lunch Settings</div>
                    <div class="setting-item">
                        <span>Duration</span>
                        <select class="form-select" id="settingsLunchDuration" onchange="updateLunchDuration()" style="width:120px; padding:8px;">
                            <option value="5">5 min</option>
                            <option value="30">30 min</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="logout()" style="max-width:100%;">üö™ Logout</button>
            </div>
        </div>
        
        <div class="nav-bar">
            <button class="nav-item active" onclick="showTab('clock')">
                <span class="nav-icon">‚è±Ô∏è</span>
                <span class="nav-label">Clock</span>
            </button>
            <button class="nav-item" onclick="showTab('history')">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">History</span>
            </button>
            <button class="nav-item" onclick="showTab('settings')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Settings</span>
            </button>
        </div>
    </div>
    
    <!-- GREEN CARD MODAL -->
    <div class="modal" id="greenCardModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">üìÑ Green Card Data</span>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="green-card-output" id="greenCardOutput"></div>
            <button class="btn btn-primary" onclick="copyGreenCard()" style="max-width:100%;">üìã Copy to Clipboard</button>
        </div>
    </div>
    
    <script>
        const CODES_KEY = 'genesis_invite_codes';
        const PROFILE_KEY = 'postal_profile';
        const ENTRIES_KEY = 'postal_entries';
        
        let profile = null;
        let todayEntries = [];
        let currentEntry = null;
        let timerInterval = null;
        let startTime = null;
        let selectedActivity = 'casing';
        let isOnLunch = false;
        let isOnBreak = false;
        let lunchStartTime = null;
        let lunchTimerInterval = null;
        let breaksUsedToday = 0;
        
        const activityLabels = {
            // Carrier
            casing: 'Casing Mail',
            delivering: 'Delivering',
            loading: 'Loading',
            office: 'Office Work',
            travel: 'Travel',
            other: 'Other',
            // Clerk
            box_parcels: 'Box Parcels',
            box_mail: 'Box Mail',
            throwing: 'Throwing Parcels',
            window: 'Window Clerk',
            dispatch: 'Dispatch',
            rfs: 'RFS',
            pars: 'PARS',
            ubbm: 'UBBM',
            mte: 'MTE',
            misc: 'Miscellaneous'
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const savedProfile = localStorage.getItem(PROFILE_KEY);
            const validatedCode = localStorage.getItem('postal_validated_code');
            
            if (validatedCode && savedProfile) {
                profile = JSON.parse(savedProfile);
                loadTodayEntries();
                showMainApp();
            } else if (validatedCode) {
                showScreen('setupScreen');
            }
            
            updateDate();
        });
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function validateCode() {
            let code = document.getElementById('inviteCode').value.trim().toUpperCase();
            const errorEl = document.getElementById('codeError');
            
            if (!code.startsWith('POSTAL-')) {
                code = 'POSTAL-' + code;
            }
            
            if (!code || code.length < 10) {
                errorEl.textContent = '‚ùå Please enter your invite code';
                errorEl.classList.add('show');
                return;
            }
            
            if (code.startsWith('POSTAL-') && code.length >= 11) {
                localStorage.setItem('postal_validated_code', code);
                errorEl.classList.remove('show');
                showScreen('setupScreen');
                return;
            }
            
            errorEl.textContent = '‚ùå Invalid code format';
            errorEl.classList.add('show');
        }
        
        function updateSetupOptions() {
            const type = document.getElementById('employeeType').value;
            const carrierGroup = document.getElementById('carrierTypeGroup');
            const clerkGroup = document.getElementById('clerkTypeGroup');
            const lunchGroup = document.getElementById('lunchDurationGroup');
            const lunchSelect = document.getElementById('lunchDuration');
            const lunchHint = document.getElementById('lunchHint');
            
            carrierGroup.classList.add('hidden');
            clerkGroup.classList.add('hidden');
            lunchGroup.classList.add('hidden');
            
            if (type === 'carrier') {
                carrierGroup.classList.remove('hidden');
                lunchGroup.classList.remove('hidden');
                lunchSelect.value = '5';
                lunchHint.textContent = 'üí° Carriers typically record 5 min lunch. Adjust if needed.';
            } else if (type === 'clerk') {
                clerkGroup.classList.remove('hidden');
                lunchGroup.classList.remove('hidden');
                lunchSelect.value = '30';
                lunchHint.textContent = 'üí° Lunch is unpaid. You\'ll clock out and back in.';
            }
        }
        
        function completeSetup() {
            const name = document.getElementById('employeeName').value.trim();
            const empType = document.getElementById('employeeType').value;
            const carrierType = document.getElementById('carrierType').value;
            const clerkType = document.getElementById('clerkType').value;
            const lunchDuration = document.getElementById('lunchDuration').value;
            const office = document.getElementById('officeLocation').value.trim();
            
            if (!name || !empType) {
                alert('Please fill in your name and employee type');
                return;
            }
            
            profile = {
                name: name,
                employeeType: empType,
                subType: empType === 'carrier' ? carrierType : clerkType,
                lunchDuration: parseInt(lunchDuration),
                office: office || 'Not specified',
                created: new Date().toISOString()
            };
            
            localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
            
            loadTodayEntries();
            showMainApp();
        }
        
        function showMainApp() {
            showScreen('mainScreen');
            
            const typeLabel = profile.subType ? profile.subType.toUpperCase() : profile.employeeType;
            document.getElementById('employeeBadge').textContent = `${typeLabel} - ${profile.name}`;
            document.getElementById('settingsName').textContent = profile.name;
            document.getElementById('settingsType').textContent = typeLabel;
            document.getElementById('settingsOffice').textContent = profile.office;
            document.getElementById('settingsLunchDuration').value = profile.lunchDuration;
            
            // Show correct activity grid
            if (profile.employeeType === 'clerk') {
                document.getElementById('carrierActivities').classList.add('hidden');
                document.getElementById('clerkActivities').classList.remove('hidden');
                document.getElementById('routeInputLabel').textContent = 'Task/Area';
                document.getElementById('routeNumber').placeholder = 'e.g., Window 3, Dock';
                selectedActivity = 'box_parcels';
            } else {
                document.getElementById('carrierActivities').classList.remove('hidden');
                document.getElementById('clerkActivities').classList.add('hidden');
                document.getElementById('routeInputLabel').textContent = 'Route Number';
                document.getElementById('routeNumber').placeholder = 'e.g., Route 5';
                selectedActivity = 'casing';
            }
            
            // Count breaks used today
            breaksUsedToday = todayEntries.filter(e => e.isBreak).length;
            updateBreaksDisplay();
            
            renderEntries();
            updateTotals();
        }
        
        function updateDate() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const now = new Date();
            document.getElementById('dateDisplay').textContent = 
                `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
        }
        
        function loadTodayEntries() {
            const today = new Date().toDateString();
            const saved = JSON.parse(localStorage.getItem(ENTRIES_KEY) || '{}');
            todayEntries = saved[today] || [];
        }
        
        function saveTodayEntries() {
            const today = new Date().toDateString();
            const saved = JSON.parse(localStorage.getItem(ENTRIES_KEY) || '{}');
            saved[today] = todayEntries;
            localStorage.setItem(ENTRIES_KEY, JSON.stringify(saved));
        }
        
        function selectActivity(btn) {
            const parent = btn.closest('.activity-grid');
            parent.querySelectorAll('.activity-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedActivity = btn.dataset.activity;
        }
        
        function clockIn() {
            const taskInput = document.getElementById('routeNumber').value.trim() || 
                (profile.employeeType === 'clerk' ? 'General' : 'Main Route');
            
            currentEntry = {
                id: Date.now(),
                task: taskInput,
                activity: selectedActivity,
                activityLabel: activityLabels[selectedActivity] || selectedActivity,
                startTime: new Date().toISOString(),
                endTime: null,
                duration: 0,
                isLunch: false,
                isBreak: false
            };
            
            startTime = new Date();
            startTimer();
            
            document.getElementById('statusLabel').textContent = 'Working';
            document.getElementById('currentActivityDisplay').textContent = 
                `${taskInput} - ${activityLabels[selectedActivity] || selectedActivity}`;
            document.getElementById('mainActions').classList.add('hidden');
            document.getElementById('activeActions').classList.remove('hidden');
            document.getElementById('routeInputGroup').classList.add('hidden');
            document.getElementById('carrierActivities').classList.add('hidden');
            document.getElementById('clerkActivities').classList.add('hidden');
        }
        
        function clockOut() {
            if (!currentEntry) return;
            
            stopTimer();
            
            currentEntry.endTime = new Date().toISOString();
            currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
            todayEntries.push(currentEntry);
            saveTodayEntries();
            
            resetToReady();
            renderEntries();
            updateTotals();
        }
        
        function switchActivity() {
            if (!currentEntry) return;
            
            stopTimer();
            currentEntry.endTime = new Date().toISOString();
            currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
            todayEntries.push(currentEntry);
            saveTodayEntries();
            
            // Show inputs for new activity
            document.getElementById('mainActions').classList.remove('hidden');
            document.getElementById('activeActions').classList.add('hidden');
            document.getElementById('routeInputGroup').classList.remove('hidden');
            
            if (profile.employeeType === 'clerk') {
                document.getElementById('clerkActivities').classList.remove('hidden');
            } else {
                document.getElementById('carrierActivities').classList.remove('hidden');
            }
            
            document.getElementById('statusLabel').textContent = 'Select New Activity';
            document.getElementById('currentActivityDisplay').textContent = '';
            document.getElementById('timerDisplay').textContent = '00:00:00';
            
            currentEntry = null;
            startTime = null;
            
            renderEntries();
            updateTotals();
        }
        
        function startLunch() {
            if (!currentEntry && !isOnLunch) {
                // If not clocked in, start lunch directly
            } else if (currentEntry) {
                // Save current work entry
                stopTimer();
                currentEntry.endTime = new Date().toISOString();
                currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
                todayEntries.push(currentEntry);
                saveTodayEntries();
            }
            
            isOnLunch = true;
            lunchStartTime = new Date();
            
            currentEntry = {
                id: Date.now(),
                task: 'Lunch',
                activity: 'lunch',
                activityLabel: 'Lunch Break',
                startTime: lunchStartTime.toISOString(),
                endTime: null,
                duration: 0,
                isLunch: true,
                isBreak: false
            };
            
            startTime = lunchStartTime;
            startTimer();
            startLunchCountdown();
            
            document.getElementById('statusCard').classList.add('on-lunch');
            document.getElementById('statusLabel').textContent = 'üçî On Lunch';
            document.getElementById('currentActivityDisplay').textContent = `${profile.lunchDuration} min lunch break`;
            document.getElementById('activeActions').classList.add('hidden');
            document.getElementById('mainActions').classList.add('hidden');
            document.getElementById('lunchActions').classList.remove('hidden');
            document.getElementById('lunchInfoBox').classList.remove('hidden');
            document.getElementById('routeInputGroup').classList.add('hidden');
            document.getElementById('carrierActivities').classList.add('hidden');
            document.getElementById('clerkActivities').classList.add('hidden');
            
            renderEntries();
        }
        
        function startLunchCountdown() {
            const lunchMs = profile.lunchDuration * 60 * 1000;
            const alertTime = lunchMs - 30000; // 30 seconds before end
            
            lunchTimerInterval = setInterval(() => {
                const elapsed = new Date() - lunchStartTime;
                const remaining = lunchMs - elapsed;
                
                if (remaining <= 0) {
                    document.getElementById('lunchRemaining').textContent = '0:00';
                    clearInterval(lunchTimerInterval);
                    // Auto end lunch
                    showLunchAlert(0);
                } else {
                    const mins = Math.floor(remaining / 60000);
                    const secs = Math.floor((remaining % 60000) / 1000);
                    document.getElementById('lunchRemaining').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                    
                    // Show alert when 30 seconds remaining
                    if (remaining <= 30000 && remaining > 29000) {
                        showLunchAlert(30);
                    }
                }
            }, 1000);
        }
        
        function showLunchAlert(seconds) {
            const alert = document.getElementById('lunchAlert');
            alert.classList.add('show');
            
            // Play sound if possible
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp2dlpmTkY+NjImHhYOBf356');
                audio.play().catch(() => {});
            } catch(e) {}
            
            // Vibrate if possible
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500]);
            }
            
            let countdown = seconds;
            const countdownEl = document.getElementById('lunchCountdown');
            countdownEl.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownEl.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }
        
        function endLunch() {
            if (!isOnLunch) return;
            
            clearInterval(lunchTimerInterval);
            stopTimer();
            
            document.getElementById('lunchAlert').classList.remove('show');
            
            currentEntry.endTime = new Date().toISOString();
            currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
            todayEntries.push(currentEntry);
            saveTodayEntries();
            
            isOnLunch = false;
            lunchStartTime = null;
            
            document.getElementById('statusCard').classList.remove('on-lunch');
            document.getElementById('lunchInfoBox').classList.add('hidden');
            document.getElementById('lunchActions').classList.add('hidden');
            
            resetToReady();
            renderEntries();
            updateTotals();
        }
        
        function startBreak() {
            if (breaksUsedToday >= 2) {
                alert('You have already used both breaks today');
                return;
            }
            
            if (currentEntry && !isOnBreak) {
                // Save current work
                stopTimer();
                currentEntry.endTime = new Date().toISOString();
                currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
                todayEntries.push(currentEntry);
                saveTodayEntries();
            }
            
            isOnBreak = true;
            breaksUsedToday++;
            updateBreaksDisplay();
            
            currentEntry = {
                id: Date.now(),
                task: `Break ${breaksUsedToday}`,
                activity: 'break',
                activityLabel: `Break ${breaksUsedToday} (15 min)`,
                startTime: new Date().toISOString(),
                endTime: null,
                duration: 0,
                isLunch: false,
                isBreak: true
            };
            
            startTime = new Date();
            startTimer();
            
            document.getElementById('statusCard').classList.add('on-break');
            document.getElementById('statusLabel').textContent = '‚òï On Break';
            document.getElementById('currentActivityDisplay').textContent = `Break ${breaksUsedToday} of 2 (15 min - paid)`;
            
            // Start 15 min countdown
            setTimeout(() => {
                if (isOnBreak) {
                    alert('‚è∞ Break time is over!');
                    if (navigator.vibrate) navigator.vibrate([500, 200, 500]);
                }
            }, 15 * 60 * 1000);
            
            document.getElementById('activeActions').innerHTML = `
                <button class="action-btn btn-end-lunch" onclick="endBreak()">‚úÖ End Break</button>
            `;
            document.getElementById('mainActions').classList.add('hidden');
            document.getElementById('activeActions').classList.remove('hidden');
            document.getElementById('routeInputGroup').classList.add('hidden');
            document.getElementById('carrierActivities').classList.add('hidden');
            document.getElementById('clerkActivities').classList.add('hidden');
        }
        
        function endBreak() {
            if (!isOnBreak) return;
            
            stopTimer();
            
            currentEntry.endTime = new Date().toISOString();
            currentEntry.duration = Math.floor((new Date() - new Date(currentEntry.startTime)) / 1000);
            todayEntries.push(currentEntry);
            saveTodayEntries();
            
            isOnBreak = false;
            document.getElementById('statusCard').classList.remove('on-break');
            
            // Restore normal action buttons
            document.getElementById('activeActions').innerHTML = `
                <button class="action-btn btn-switch" onclick="switchActivity()">üîÑ Switch</button>
                <button class="action-btn btn-lunch" onclick="startLunch()">üçî Lunch</button>
                <button class="action-btn btn-clock-out" onclick="clockOut()">‚èπÔ∏è Out</button>
            `;
            
            resetToReady();
            renderEntries();
            updateTotals();
        }
        
        function updateBreaksDisplay() {
            document.getElementById('breaksUsed').textContent = `${breaksUsedToday} of 2 used`;
            document.getElementById('breakBtn').disabled = breaksUsedToday >= 2;
            if (breaksUsedToday >= 2) {
                document.getElementById('breakBtn').style.opacity = '0.5';
            }
        }
        
        function resetToReady() {
            currentEntry = null;
            startTime = null;
            
            document.getElementById('statusLabel').textContent = 'Ready to Clock In';
            document.getElementById('currentActivityDisplay').textContent = '';
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('mainActions').classList.remove('hidden');
            document.getElementById('activeActions').classList.add('hidden');
            document.getElementById('lunchActions').classList.add('hidden');
            document.getElementById('routeInputGroup').classList.remove('hidden');
            
            if (profile.employeeType === 'clerk') {
                document.getElementById('clerkActivities').classList.remove('hidden');
            } else {
                document.getElementById('carrierActivities').classList.remove('hidden');
            }
            
            // Restore active actions HTML
            document.getElementById('activeActions').innerHTML = `
                <button class="action-btn btn-switch" onclick="switchActivity()">üîÑ Switch</button>
                <button class="action-btn btn-lunch" onclick="startLunch()">üçî Lunch</button>
                <button class="action-btn btn-clock-out" onclick="clockOut()">‚èπÔ∏è Out</button>
            `;
        }
        
        function startTimer() {
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        function updateTimer() {
            if (!startTime) return;
            const elapsed = Math.floor((new Date() - startTime) / 1000);
            document.getElementById('timerDisplay').textContent = formatTime(elapsed);
        }
        
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        
        function formatTimeShort(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            return `${h}:${m.toString().padStart(2, '0')}`;
        }
        
        function renderEntries() {
            const list = document.getElementById('entriesList');
            
            if (todayEntries.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#666; padding:20px;">No entries yet today</div>';
                return;
            }
            
            list.innerHTML = todayEntries.map(e => {
                const startT = new Date(e.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const endT = e.endTime ? new Date(e.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Active';
                const entryClass = e.isLunch ? 'lunch-entry' : (e.isBreak ? 'break-entry' : '');
                const icon = e.isLunch ? 'üçî' : (e.isBreak ? '‚òï' : 'üìã');
                
                return `
                    <div class="entry-item ${entryClass}">
                        <div class="entry-info">
                            <div class="entry-name">${icon} ${e.task}</div>
                            <div class="entry-times">${e.activityLabel} ‚Ä¢ ${startT} - ${endT}</div>
                        </div>
                        <div class="entry-duration">${formatTimeShort(e.duration)}</div>
                    </div>
                `;
            }).join('');
        }
        
        function updateTotals() {
            let workTotal = 0;
            let lunchTotal = 0;
            let breakTotal = 0;
            
            todayEntries.forEach(e => {
                if (e.isLunch) {
                    lunchTotal += e.duration;
                } else if (e.isBreak) {
                    breakTotal += e.duration;
                } else {
                    workTotal += e.duration;
                }
            });
            
            // Breaks count as work time
            workTotal += breakTotal;
            
            document.getElementById('totalWork').textContent = formatTimeShort(workTotal);
            document.getElementById('totalLunch').textContent = formatTimeShort(lunchTotal);
            document.getElementById('totalBreaks').textContent = formatTimeShort(breakTotal);
        }
        
        function updateLunchDuration() {
            profile.lunchDuration = parseInt(document.getElementById('settingsLunchDuration').value);
            localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
        }
        
        function showGreenCard() {
            let output = `GREEN CARD DATA - ${new Date().toLocaleDateString()}\n`;
            output += `Employee: ${profile.name}\n`;
            output += `Type: ${profile.subType || profile.employeeType}\n`;
            output += `Office: ${profile.office}\n`;
            output += `${'='.repeat(40)}\n\n`;
            
            let totalWork = 0;
            let totalLunch = 0;
            let totalBreaks = 0;
            
            todayEntries.forEach(e => {
                const start = new Date(e.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const end = e.endTime ? new Date(e.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Active';
                
                output += `${e.task}\n`;
                output += `  Activity: ${e.activityLabel}\n`;
                output += `  Time: ${start} - ${end}\n`;
                output += `  Duration: ${formatTimeShort(e.duration)}\n\n`;
                
                if (e.isLunch) totalLunch += e.duration;
                else if (e.isBreak) totalBreaks += e.duration;
                else totalWork += e.duration;
            });
            
            totalWork += totalBreaks; // Breaks are paid
            
            output += `${'='.repeat(40)}\n`;
            output += `TOTAL WORK TIME: ${formatTimeShort(totalWork)}\n`;
            output += `TOTAL LUNCH (unpaid): ${formatTimeShort(totalLunch)}\n`;
            output += `TOTAL BREAKS (paid): ${formatTimeShort(totalBreaks)}\n`;
            
            document.getElementById('greenCardOutput').textContent = output;
            document.getElementById('greenCardModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('greenCardModal').classList.remove('show');
        }
        
        function copyGreenCard() {
            const output = document.getElementById('greenCardOutput').textContent;
            navigator.clipboard.writeText(output).then(() => {
                alert('‚úÖ Copied to clipboard!');
            });
        }
        
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(tab + 'Tab').classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            if (tab === 'history') renderHistory();
        }
        
        function renderHistory() {
            const saved = JSON.parse(localStorage.getItem(ENTRIES_KEY) || '{}');
            const list = document.getElementById('historyList');
            const dates = Object.keys(saved).sort().reverse();
            
            if (dates.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#666; padding:30px;">No history yet</div>';
                return;
            }
            
            list.innerHTML = dates.map(date => {
                const entries = saved[date];
                const totalWork = entries.filter(e => !e.isLunch).reduce((sum, e) => sum + e.duration, 0);
                const totalLunch = entries.filter(e => e.isLunch).reduce((sum, e) => sum + e.duration, 0);
                const activities = [...new Set(entries.filter(e => !e.isLunch && !e.isBreak).map(e => e.activityLabel))].join(', ');
                
                return `
                    <div class="history-item">
                        <div class="history-date">${date}</div>
                        <div class="history-details">${activities || 'No activities'}</div>
                        <div class="history-total">Work: ${formatTimeShort(totalWork)} | Lunch: ${formatTimeShort(totalLunch)}</div>
                    </div>
                `;
            }).join('');
        }
        
        function logout() {
            if (currentEntry) {
                alert('Please clock out first');
                return;
            }
            
            if (confirm('Logout? Your data will be saved.')) {
                localStorage.removeItem(PROFILE_KEY);
                localStorage.removeItem('postal_validated_code');
                location.reload();
            }
        }
    </script>
</body>
</html>
